{
  "variables": {
    "disk_size": "40",
    "iso_url": "file:///home/ubuntu/downloads/en_windows_server_2019_updated_march_2019_x64_dvd_2ae967ab.iso",
    "iso_checksum": "55ac0f541bcc9ce2f70af4227239fc4a6a1e2b6e",
    "iso_checksum_type": "sha1",
    "image_build_name": "windows2019-stemcell-base",
    "vs_download_url": "",
    "nuget_download_url": "",
    "bosh_ps_modules_download_url": "",
    "bosh_agent_download_url": "",
    "openssh_win64_download_url": "",
    "custom_file_upload": "",
    "custom_ps1_script": "",
    "root_dir": "/home/ubuntu/pivotal/pcf-automation-control-plane"
  },
  "builders": [
    {
      "vm_name": "{{user `image_build_name`}}",
      "type": "qemu",
      "accelerator": "kvm",
      "qemuargs": [
        [
          "-m",
          "2048"
        ],
        [
          "-cpu",
          "host"
        ],
        [
          "-smp",
          "2"
        ],
        [
          "-soundhw",
          "hda"
        ],
        [
          "-usbdevice",
          "tablet"
        ],
        [
          "-device",
          "virtio-net,netdev=user.0"
        ],
        [
          "-vga",
          "qxl"
        ],
        [
          "-device",
          "virtio-serial-pci"
        ],
        [
          "-chardev",
          "socket,path=/tmp/{{.Name}}-qga.sock,server,nowait,id=qga0"
        ],
        [
          "-device",
          "virtserialport,chardev=qga0,name=org.qemu.guest_agent.0"
        ],
        [
          "-chardev",
          "spicevmc,id=spicechannel0,name=vdagent"
        ],
        [
          "-device",
          "virtserialport,chardev=spicechannel0,name=com.redhat.spice.0"
        ],
        [
          "-spice",
          "unix,addr=/tmp/{{.Name}}-spice.socket,disable-ticketing"
        ]
      ],
      "headless": true,
      "format": "qcow2",
      "disk_size": "{{user `disk_size`}}",
      "disk_interface": "virtio",
      "iso_url": "{{user `iso_url`}}",
      "iso_checksum": "{{user `iso_checksum`}}",
      "iso_checksum_type": "{{user `iso_checksum_type`}}",
      "floppy_files": [
        "{{ user `root_dir` }}/src/stemcells/packer/openstack/windows2019/autounattend.xml",
        "{{ user `root_dir` }}/src/stemcells/scripts/windows/prepare.ps1",
        "drivers/vioserial/2k19/amd64/*.cat",
        "drivers/vioserial/2k19/amd64/*.inf",
        "drivers/vioserial/2k19/amd64/*.sys",
        "drivers/viostor/2k19/amd64/*.cat",
        "drivers/viostor/2k19/amd64/*.inf",
        "drivers/viostor/2k19/amd64/*.sys",
        "drivers/NetKVM/2k19/amd64/*.cat",
        "drivers/NetKVM/2k19/amd64/*.inf",
        "drivers/NetKVM/2k19/amd64/*.sys",
        "drivers/qxldod/2k19/amd64/*.cat",
        "drivers/qxldod/2k19/amd64/*.inf",
        "drivers/qxldod/2k19/amd64/*.sys"
      ],
      "http_directory": ".",
      "shutdown_command": "shutdown /s /t 0 /f /d p:4:1 /c \"Packer Shutdown\"",
      "vnc_bind_address": "0.0.0.0",
      "communicator": "winrm",
      "winrm_username": "Administrator",
      "winrm_password": "P@ssw0rd",
      "winrm_timeout": "4h",
      "output_directory": "{{ user `root_dir` }}/.stembuild/windows2019"
    }
  ],
  "provisioners": [
    {
      "type": "powershell",
      "script": "{{ user `root_dir` }}/src/stemcells/scripts/windows/prepare.ps1"
    },
    {
      "type": "windows-restart"
    }
  ]
}